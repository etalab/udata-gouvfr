{% extends "home.html" %}

{% set body_class = 'home' %}

{% set read_only_mode = config.READ_ONLY_MODE %}

{% block subnav %}
    {% include theme('subnav-large.html') %}
{% endblock %}

{% block content %}
{% cache cache_duration, 'home', g.lang_code %}

{# Last inventories section #}
<section class="default">
    <div class="container">
        {# First row #}
        <div class="row">
            <div class="col-xs-12">
                <h3>
                    <a href="{{ url_for('gouvfr.show_page', slug='donnees-cles-par-sujet') }}"
                        title="Thématiques à la une">
                        Thématiques à la une
                    </a>
                </h3>
                <div class="row">
                    <ul class="card-list card-list--columned">
                        <li class="col-sm-4 col-xs-12">
                            <a class="card-link" href="{{ url_for('gouvfr.spd') }}">
                            <div class="inventory-card red">
                                <h4 class="inventory-text">Données de<span class="inventory-title">RÉFÉRENCE</span></h4>
                            </div>
                            </a>
                        </li>
                        <li class="col-sm-4 col-xs-12">
                            <a class="card-link" href="{{ url_for('gouvfr.show_page', slug='donnees-coronavirus') }}">
                            <div class="inventory-card grey">
                                <h4 class="inventory-text">Données relatives à la<span class="inventory-title">COVID-19</span></h4>
                            </div>
                            </a>
                        </li>
                        <li class="col-sm-4 col-xs-12">
                            <a class="card-link" href="{{ url_for('gouvfr.show_page', slug='donnees-comptes-publics') }}">
                            <div class="inventory-card blue">
                                <h4 class="inventory-text">Données relatives aux<span class="inventory-title">COMPTES PUBLICS</span></h4>
                            </div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        {# end first row #}
    </div>
</section>
{# End last inventories section #}

{# Datasets section #}
{% set nb_datasets = current_site.settings.home_datasets|length %}
{% set datasets_list = current_site.settings.home_datasets %}

<section class="default">
      <div class="container">
            {# Dataset tabs #}
            <div class="row">
                <div class="col-xs-12">
                    <h3>
                        <a href="{{ url_for('datasets.list', sort='-created') }}">
                            {{ _('Datasets') }}
                        </a>
                    </h3>
                </div>
            </div>

            <div class="row">
                <div class="card-list card-list--columned">

                    {% for dataset in datasets_list %}
                    <div class="col-xs-12 col-md-4 col-sm-6">
                        {% include theme('dataset/card.html') %}
                    </div>
                    {% endfor %}

                </div>
                <div class="clearfix"></div>
                <p class="text-center">
                    <a href="{{ url_for('datasets.list', **kwargs) }}" class="btn btn-default">
                        <span class="fa fa-fw fa-list" ></span>
                        {{ _('See more') }}
                    </a>
                </p>
            </div>
            {# end Dataset tabs #}
      </div>
</section>
{# End datasets section #}

{% if last_post %}
{% set post = last_post %}
<section class="highlight-bar">

    <div class="photo-bg">
        <img src="{{ post.image|placeholder('post') }}"
            alt="{{ post.name }}">
    </div>
    <div class="color-overlay"></div>

    <div class="container">
        <div class="row">
            <div class="photo hidden-xs col-xs-4">
                <img src="{{ post.image|placeholder('post') }}"
                    alt="{{ post.name }}">
            </div>

            <div class="body col-sm-8">
                <label>{{ _('News in data') }}</label>
                <h3 class="title">
                    <a href="{{ url_for('posts.show', post=post) }}"
                        title="{{ post.name }}">
                        {{ post.name }}
                    </a>
                </h3>
                <p>{{(post.headline or post.content)|mdstrip(280)}}</p>
            </div>
        </div>
    </div>
</section>
{% endif %}

{# Reuses section #}
{% set nb_reuses = current_site.settings.home_reuses|length %}
{% set reuses_list = current_site.settings.home_reuses %}

<section class="default">
      <div class="container">
            {# Reuse tabs #}
            <div class="row">
                <div class="col-xs-12">
                    <h3>
                        <a href="{{ url_for('reuses.list', sort='-created') }}">
                            {{ _('Reuses') }}
                        </a>
                    </h3>
                </div>
            </div>

            <div class="row">
                <div class="card-list card-list--columned">

                    {% for reuse in reuses_list %}
                    {% set features = ['preview'] %}
                    <li class="col-sm-4 col-xs-12">
                        {% include theme('reuse/card.html') %}
                    </li>
                    {% endfor %}

                </div>
                <div class="clearfix"></div>
                <p class="text-center">
                    <a href="{{ url_for('datasets.list', **kwargs) }}" class="btn btn-default">
                        <span class="fa fa-fw fa-list" ></span>
                        {{ _('See more') }}
                    </a>
                </p>
            </div>
            {# end Reuse tabs #}
      </div>
</section>
{# End reuse section #}

{# Blog section #}
{% if blogpost %}
<section class="default blog">
      <div class="container blog-container">
            <div class="row">
                <div class="col-xs-12">
                    <h3>{{ _('The blog') }}</h3>
                </div>
            </div>

            <div class="row gray">
                {% set has_thumbnail = blogpost.image_url is defined %}
                {% if has_thumbnail %}
                <div class="col-xs-12 col-sm-4 photo blog-thumbnail">
                    <img src="{{ blogpost.image_url|safe }}" alt="{{ blogpost.title|safe }}">
                </div>
                {% endif  %}
                <div class="col-xs-12 {% if has_thumbnail %}col-sm-8 {% endif %}body">
                    <span class="post-date">{{blogpost.date|dateformat('long')|title}}</span>
                    <h4>
                        <a href="{{ blogpost.link }}"
                            title="{{ blogpost.title|safe }}">
                            {{ blogpost.title|safe }}
                        </a>
                    </h4>
                    <p>
                        {{ blogpost.summary|striptags|truncate(400) }}
                        <a href="{{ blogpost.link }}"
                            title="{{ _('more') }}"
                            class="btn btn-grey btn-primary btn-mini">+</a>
                    </p>

                </div>
            </div>
      </div>
</section>
{% endif %}
{% if forum_topics %}
<section class="default forum-topics">
    {% include theme('forum.html')  %}
</section>
{% endif %}
{# End blog section #}
{% endcache %}
{% endblock %}

{% block extra_js %}
    {% if request.args.get('flag') == 'recherche' -%}
        <script src="https://recherche.etalab.studio/js/widget.js"></script>
    {%- endif %}
{% endblock %}
